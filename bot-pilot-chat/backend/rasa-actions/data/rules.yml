version: "3.1"

rules:
  - rule: Begrüßung antworten
    steps:
      - intent: begruessung
      - action: action_begruessung
  - rule: Verabschiedung antworten
    steps:
      - intent: verabschiedung
      - action: action_verabschiedung
  - rule: default fallback
    condition:
      - active_loop: null
    steps:
      - intent: nlu_fallback
      - action: action_default_fallback
  - rule: Positives Feedback
    steps:
      - intent: positive_feedback
      - action: action_positive_feedback
  - rule: Negatives Feedback
    steps:
      - intent: negative_feedback
      - action: action_negative_feedback
  - rule: FAQ beantworten
    steps:
      - intent: faq
      - action: action_get_faq
  - rule: Allgemeine Bot-Frage
    condition:
      - active_loop: null
    steps:
      - intent: general_bot
      - action: action_general_bot
  - rule: Anreise
    steps:
      - intent: anreise
      - action: action_anreise
  - rule: Bereiche
    steps:
      - intent: bereiche
      - action: action_bereiche
  - rule: Kosten
    steps:
      - intent: kosten
      - action: action_kosten
  - rule: Parking
    steps:
      - intent: parking
      - action: action_parking
  - rule: Standort
    steps:
      - intent: standort
      - action: action_standort
  - rule: Steuerberatung
    steps:
      - intent: steuerberatung
      - action: action_steuerberatung
  - rule: Steuererklärung
    steps:
      - intent: steuererklaerung
      - action: action_steuererklaerung
  - rule: Unterlagen
    steps:
      - intent: unterlagen
      - action: action_unterlagen
  - rule: Zeiten
    steps:
      - intent: zeiten
      - action: action_zeiten

  - rule: Aktivierung Termin-Form
    condition:
      - active_loop: null
    steps:
      - intent: termin_vereinbaren
      - action: termin_form
      - active_loop: termin_form

  - rule: switch to make_meeting_form
    condition:
      - active_loop: consultant_form
      - slot_was_set:
          - requested_slot: null
    steps:
      - action: consultant_form
      - active_loop: null
      - action: action_switch_form
      - slot_was_set:
          - next_form_name: make_meeting_form
      - action: make_meeting_form
      - active_loop: make_meeting_form

  - rule: Switch to user_type_form
    condition:
      - active_loop: termin_form
      - slot_was_set:
          - requested_slot: null
    steps:
      - action: termin_form
      - active_loop: null
      - action: action_switch_form
      - slot_was_set:
          - next_form_name: user_type_form
      - action: user_type_form
      - active_loop: user_type_form

  - rule: Switch from user type form to user info form
    condition:
      - active_loop: user_type_form
      - slot_was_set:
          - requested_slot: null
    steps:
      - action: user_type_form
      - active_loop: null
      - action: action_switch_form
      - slot_was_set:
          - next_form_name: user_info_form
      - action: user_info_form
      - active_loop: user_info_form

  - rule: Switch from user info form to consultant form
    condition:
      - active_loop: user_info_form
      - slot_was_set:
          - requested_slot: null
    steps:
      - action: user_info_form
      - active_loop: null
      - action: action_switch_form
      - slot_was_set:
          - next_form_name: consultant_form
      - action: consultant_form
      - active_loop: consultant_form

  - rule: end termin_form after ask_continue_and_deny
    condition:
      - active_loop: termin_form
      - slot_was_set:
          - termin_medium_attempts: 3
    steps:
      - action: action_ask_continue
      - intent: deny
      - active_loop: null

  - rule: ask to confirm name after user_name_inform with affirm
    condition:
      - active_loop: user_info_form
      - slot_was_set:
          - requested_slot: user_name
    steps:
      - intent: affirm
      - action: action_handle_user_name_confirm
      - action: user_info_form
      - active_loop: user_info_form

  - rule: ask to confirm name after user_name_inform with deny
    condition:
      - active_loop: user_info_form
      - slot_was_set:
          - requested_slot: user_name
    steps:
      - intent: deny
      - action: action_handle_user_name_confirm
      - action: user_info_form
      - active_loop: user_info_form

  - rule: end termin_form after ask_continue deny
    condition:
      - active_loop: termin_form
      - slot_was_set:
          - termin_medium_attempts: 3
    steps:
      - action: action_ask_continue
      - intent: deny
      - active_loop: null

  - rule: progress termin_form after ask_continue affirm
    condition:
      - active_loop: termin_form
      - slot_was_set:
          - termin_medium_attempts: 3
    steps:
      - action: action_ask_continue
      - intent: affirm
      - action: termin_form
      - active_loop: termin_form

  - rule: submit all slots after make_meeting_form
    condition:
      - active_loop: make_meeting_form
      - slot_was_set:
          - requested_slot: null
    steps:
      - action: make_meeting_form
      - active_loop: null
      - action: action_submit_make_meeting_form
      - action: action_ask_feedback

  - rule: ask for feedback after submit make_meeting_form
    steps:
      - action: action_submit_make_meeting_form
      - action: action_ask_feedback
